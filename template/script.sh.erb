#!/bin/bash

# Benchmark info
echo "TIMING - Starting main script at: $(date)"

# Set working directory to home directory
cd "${HOME}"

#
# Start Jupyter Notebook Server
#

# Purge the environment to avoid conflicts
module purge

<%- if context.dsmodules == "1" -%>
module load 
<%- end -%>

<%- if context.advanced == "1" -%>
<%- unless context.modules.blank? || context.version == "custom"-%>
# Load the requested modules
module load <%= context.modules %>

# List loaded modules
module list
<%- end -%>

<%- unless context.version == "custom" -%>
# Load requested version
MODULE=<%= context.version %>
<%- end -%>

<%- if context.version == "custom" -%>
# Execute user given commands
<%= context.commands.gsub(/\r/,"\n") %>
<%- end -%>

<%- else -%>
# Load default JupyterLab
MODULE=JupyterLab/3.0.16-GCCcore-10.3.0
<%- end -%>

module load $MODULE

# Benchmark info
echo "TIMING - Starting jupyter at: $(date)"

# Launch the Jupyter server type selected by the user
set -x
<%= context.jupyter_type %> --config="${CONFIG_FILE}"
